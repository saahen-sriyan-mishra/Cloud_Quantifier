# -------- Test stage --------
FROM node:20 AS test

WORKDIR /app

# Copy package files
COPY app/package*.json ./
COPY app/jest.config.js ./

# Install dependencies
RUN npm install

# Copy source code and tests
COPY app/src ./src/
COPY app/index.html ./
COPY tests ./tests/

# Set environment variables for testing
ENV NODE_ENV=test
ENV DATABASE_PATH=/shared-data/stocks_data.db

# Run tests
CMD ["npm", "test"]